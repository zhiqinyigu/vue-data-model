!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("vue")):"function"==typeof define&&define.amd?define(["vue"],t):"object"==typeof exports?exports.VDM=t(require("vue")):e.VDM=t(e.Vue)}(self,(function(e){return(()=>{"use strict";var t={982:t=>{t.exports=e}},i={};function r(e){var n=i[e];if(void 0!==n)return n.exports;var s=i[e]={exports:{}};return t[e](s,s.exports,r),s.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};return(()=>{function e(e){return Array.prototype.slice.call(e)}function t(e){return""+e}function i(e="Illegal state"){return new Error("[vue-data-model] "+e)}function s(e){console.error(e)}r.r(n),r.d(n,{BaseType:()=>A,ComplexType:()=>O,SimpleType:()=>P,baseMixns:()=>D,createStateModel:()=>F,fail:()=>i,getComposeRawMaterial:()=>J,getIdentifier:()=>g,getParent:()=>_,getTreeNode:()=>y,isScalarNode:()=>p,isTreeNodeValue:()=>f,logError:()=>s,normalizeIdentifier:()=>t,toArray:()=>e,toJSON:()=>d,types:()=>X});var o=r(982),a=r.n(o);const c="_$$actualValueForProxySet$$_";let h=1;class l{state=0;storedValue=void 0;constructor(e,t,i,r){this._id=h++,this.type=e,this.environment=r,this.setParent(t,i),this.state=1}get isAlive(){return 0!==this.state}get root(){const e=this.parent;return e?e.root:this}get value(){return this.type.getValue(this)}setParent(e,t){this.parent=e,this.subpath=t}_destroy(){this.state=0}}class u extends l{constructor(e,t,i,r,n){super(e,t,i,n),this._initialSnapshot=r,this.storedValue=this.type.createNewInstance(this._initialSnapshot)}get snapshot(){return this.type.getSnapshot(this)}}function d(){return y(this).snapshot}function f(e){return e&&e.$treenode}function p(e){return e instanceof u}function y(e){return e.$treenode}function g(e){return y(e).identifier}function _(e,t){let r=y(e);const n=t=t||1;for(;r;){if(0==t--)return r.storedValue;r=r.parent}throw i(`Failed to find the parent of ${JSON.stringify(e.$toValue?e.$toValue():e)} at depth ${n}`)}function m(e){return e&&"object"==typeof e&&c in e}function v(e){return e instanceof a()}function w(e){return v(e)?b(e):function(e){return JSON.parse(JSON.stringify(e))}(e)}function b(e,t){return JSON.parse(JSON.stringify(function(e){const t={},i=y(e).getChildNodes();return e.$options._each((function(r){let n;const s=e[r];if(r in i){const e=i[r];n=p(e)?e.snapshot:s.$toValue()}else n=s;t[r]=n})),t}(e),t))}function C(e){return Object.assign(...(e.mixins||[]).map(C),e.data?e.data.call(null):{})}let N=0;class ${constructor(){this.cacheId=N++,this.cache=new Map,this.lastCacheModificationPerId=new(a())({data:{sett:{}}})}updateLastCacheModificationPerId(e){const t=this.lastCacheModificationPerId.sett[e];this.lastCacheModificationPerId.sett={...this.lastCacheModificationPerId.sett,[e]:void 0===t?1:t+1}}getLastCacheModificationPerId(e){const t=this.lastCacheModificationPerId.sett[e]||0;return`${this.cacheId}-${t}`}addNodeToCache(e,t=!0){if(e.identifierAttribute){const r=e.identifier;if(!r)return;this.cache.has(r)||this.cache.set(r,[]);const n=this.cache.get(r);if(-1!==n.indexOf(e))throw i("Already registered");n.push(e),t&&this.updateLastCacheModificationPerId(r)}}removeNodeToCache(e){if(e.identifierAttribute){const t=e.identifier,i=this.cache.get(t);if(i){const r=i.indexOf(e);-1!==r&&(i.splice(r,1),this.updateLastCacheModificationPerId(t))}}}has(e,t){const i=this.cache.get(t);return!!i&&i.some((t=>e.isAssignableFrom(t.type)))}resolve(e,t){const r=this.cache.get(t);if(!r)return null;const n=r.filter((t=>e.isAssignableFrom(t.type)));switch(n.length){case 0:return null;case 1:return n[0];default:throw i(`Cannot resolve a reference to type '${e.name}' with id: '${t}' unambigously, there are multiple candidates: ${n.map((e=>e.path)).join(", ")}`)}}}class x{constructor(){this.cache=new Map}addRef(e,t){if(!t)return;this.cache.has(t)||this.cache.set(t,[]);const r=this.cache.get(t);if(-1!==r.indexOf(e))throw i("Already registered");r.push(e)}removeRefs(e,t,i){const r=this.cache.get(t);if(r){const n=r.indexOf(e);-1!==n&&(r.splice(n,1),i&&this.updateRefs(t))}}updateRefs(e){const t=this.cache.get(e);t&&t.forEach((e=>e.value))}}class S extends l{constructor(e,r,n,s,o){super(e,r,n,o);const c=this;this._childNodes={},this._initialSnapshot=s,this.vm=new(a())({computed:{snapshot:()=>e.getSnapshot(c)}}),r||(this.identifierCache=new $,this.referenceCache=new x);const h=function(e){c.storedValue=e,e.$treenode||(e.$treenode=c,e.$toValue=d)};if(h(e.createNewInstance(this._initialSnapshot,h)),this.identifierAttribute=e.identifierAttribute,this.identifier=null,this.unnormalizedIdentifier=null,this.identifierAttribute&&this._initialSnapshot){let e=this._initialSnapshot[this.identifierAttribute];if(void 0===e&&(e=this.storedValue[this.identifierAttribute]),"string"!=typeof e&&"number"!=typeof e)throw i(`Instance identifier '${this.identifierAttribute}' for type '${this.type.name}' must be a string or a number`);this.identifier=t(e),this.unnormalizedIdentifier=e}this.root.identifierCache.addNodeToCache(this),this.root.referenceCache.updateRefs(this.identifier)}replaceChildNode(e,t){this._childNodes[e]=t}getChildNodes(){return this._childNodes}removeChildNode(e){delete this._childNodes[e]}_destroy(){Object.keys(this._childNodes).forEach((e=>this._childNodes[e]._destroy())),this.root.identifierCache.removeNodeToCache(this),this.root.referenceCache.updateRefs(this.identifier),super._destroy()}get snapshot(){return this.vm.snapshot}}function I(e,t,i,r,n){return new u(e,t,i,r,n)}const V=["is","instantiate","createNewInstance"];class A{identifierAttribute;constructor(){V.forEach((e=>{if("function"!=typeof this[e])throw i(`BaseType must realize "${e}" methods`)}))}create(e,t){return this.instantiate(null,"",e,t).value}isAssignableFrom(e){return e===this}}class O extends A{constructor(){super()}create(e=this.getDefaultSnapshot(),t){return super.create(e,t)}instantiate(e,t,i,r){return function(e,t,i,r,n){return new S(e,t,i,r,n)}(this,e,t,i,r)}getDefaultSnapshot(){return{}}getValue(e){return e.storedValue}getSnapshot(e){return JSON.parse(JSON.stringify(e.storedValue))}}class P extends A{createNewInstance(e){return e}instantiate(e,t,i,r){return I(this,e,t,i,r)}getDefaultSnapshot(){}getValue(e){return e.storedValue}getSnapshot(e){return e.storedValue}}const T=e=>e,M={enumerable:!0,configurable:!0,get:null,set:null};class j extends P{constructor(e){super(),this.validType=e}createNewInstance(e){if(this.is(e))return e;throw i(`value \`${e}\` is not assignable to type: \`${this.validType}\``)}is(e){return this.validType===typeof e}}const R=(e,t)=>t,D={methods:{$assign(e,t=R){if(e&&"object"==typeof e)for(var i in e)i in this.$data&&(this[i]=t(i,e[i]))}}};function F(e){class t extends class{constructor(){const e=this;e._dormancy=!0,e.data={},e._each=e._each.bind(e),e._each((function(t,i,r,n){!function(e,t,i,r=T){M.get=function(){return t[i]},M.set=function(e){t[i]=r(e)},Object.defineProperty(e,i,M)}(e.data,i,t,n?i=>{if(!e._dormancy){if(m(i)){const e=i[c];return delete i[c],e}return e._createChildNode(r,t,i).value}}:T),e.data[t]=void 0}))}_createChildNode(e,t,i){const r=y(this.$vm),n=e.instantiate(r,`${r.subpath}/${t}`,i);return r.replaceChildNode(t,n),n}_each(e){const t=this._dataTypes||C(this.constructor.prototype);for(var i in t)if(!1===function(r){return e(i,t,r,r instanceof A,!1)}.call(this,t[i]))break}_calculateInitializeData(e,t){const i=this,r={};return e=e||{},i._each((function(n,s,o,a,c){if(r[n]=n in e?e[n]:a?o.getDefaultSnapshot():o,t){const e=!0===t;c?(e||"computed"===t)&&(i.$vm[n]=r[n]):(e||"data"===t)&&(i.data[n]=r[n])}})),r}}{}return Object.assign(t.prototype,e,{mixins:[D,...e.mixins||[]]}),t}class z extends O{constructor(e){super(),this._model_=F(e)}createNewInstance(e,t){const i=this,r=new i._model_;let n;r.mixins=[{beforeCreate(){r.$vm=this,this.__model__=i._model_,t&&t(this),r._each((function(e,t,r){if(r instanceof j)return i.identifierAttribute=e,!1}));try{r._dormancy=!1,r._calculateInitializeData(e||{},"data")}catch(e){n=e}},created(){this._beforeCreateData&&this.$assign(this._beforeCreateData)}}].concat(r.mixins);const s=new(a())(r);if(n)throw n;return s}getSnapshot(e){return b(e.storedValue)}is(e){if(e.__model__)return e.__model__===this._model_;try{return this.create(e),!0}catch(e){return!1}}}const J=function(){return Object.assign({mixins:e(arguments).map((e=>({...e._model_.prototype,mixins:e._model_.prototype.mixins.filter((e=>e!==D))})))})},{slice:E}=Array.prototype,L=e=>e?E.call(e):e,k={_overwriteParams:e=>e,push(){const e=arguments;return this._willChange&&this._willChange("push",e),this.__proto__.push.apply(this,L(arguments).map(((t,i)=>this._overwriteParams(t,i,"push",e))))},splice(e,t,...i){const r=arguments;return this._willChange&&this._willChange("splice",r),this.__proto__.splice.apply(this,[e,arguments.length>=2?t:1/0].concat(L(i).map(((e,t)=>this._overwriteParams(e,t,"splice",r)))))}};function q(){var e=new Array(...arguments);for(var t in Object.setPrototypeOf(e,q.prototype),k)e[t]=k[t];return e}Object.setPrototypeOf(q.prototype,Array.prototype),q.clone=function(e,t){const i=new q;return t&&(i._overwriteParams=t._overwriteParams,i._willChange=t._willChange,t.created&&t.created.call(i)),i.push(...Array.prototype.slice.call(e)),i};const B=q;class U extends O{constructor(e){if(super(),!e)throw i(`expected type as argument 1, got ${e} instead`);this._subType=e}createNewInstance(e,t){const i=this._subType;return B.clone(e,{created(){t&&t(this)},_willChange(e,t){const i=y(this),r=this.length;switch(e){case"splice":!function(){let[e,n,...s]=t,o=0;const a=s.length;if("number"==typeof e){n="number"==typeof n?n:1/0;for(let t=n-1;t>=0;t--){if(e+t>r)return;o++,!(s.length>=t+1&&m(s[t]))&&(i.getChildNodes()[e+t]._destroy(i),i.removeChildNode(e+t))}const t={};for(let n=r-e-o;n>0;n--){let r=e+o+n-1,s=e+a-1+n;r!==s&&(t[s]=i.getChildNodes()[r],i.removeChildNode(r))}Object.keys(t).forEach((e=>i.replaceChildNode(e,t[e])))}}()}},_overwriteParams(e,t,r,n){const s=y(this),o=this.length;switch(r){case"splice":t+=n[0]||0;break;default:t+=o}if(m(e)){const t=e[c];return delete e[c],t}const a=i.instantiate(s,`${s.subpath}/${t}`,e);return s.replaceChildNode(t,a),a.value}})}getSnapshot(e){const t=e.getChildNodes();return e.storedValue.map(((e,i)=>{const r=t[i];return p(r)?r.snapshot:w(e)}))}is(e){return e instanceof B&&!!e._overwriteParams}}class G extends P{constructor(e){super(),this.literal=e}createNewInstance(e){if(this.is(e))return this.literal;throw i(`value \`${e}\` is not assignable to type: \`${this.literal}\``)}is(e){return this.literal===e}}class H extends O{constructor(e){super(),this._types=e}isAssignableFrom(e){return this._types.some((t=>t.isAssignableFrom(e)))}createNewInstance(e){const{_types:t}=this;for(let i=0;i<t.length;i++)try{return t[i].create(e)}catch(e){}throw i("Union could not determine the type")}getSnapshot(e){return e.type.getSnapshot(e)}is(e){const{_types:t}=this;for(let i=0;i<t.length;i++)if(t[i].is(e))return!0;return!1}}class K extends O{constructor(e,t){if(super(),void 0===t)throw i("expected type or literal as argument 1, vue component options as argument 2, but only one was received.");this._model_=F(Object.assign({},t,{data:()=>({value:e})}));const r=e instanceof A,n=typeof e,s=this._model_.prototype._calculateInitializeData;this._model_.prototype._calculateInitializeData=function(t,...i){return s.call(this,{value:r?e.is(t)?t:e.create(t,this):typeof t==typeof e||"undefined"===n||null===e?t:e},...i)}}createNewInstance(){return z.prototype.createNewInstance.apply(this,arguments)}getSnapshot(e){return w(e.storedValue.value)}is(e){return z.prototype.is.call(this,e)}}class Q{identifier;resolvedReference;constructor(e,t){if(this.targetType=t,"string"==typeof(n=e)||"number"==typeof n)this.identifier=e;else if(f(e)){const t=y(e);if(!t.identifierAttribute)throw i("Can only store references with a defined identifier attribute.");const r=t.unnormalizedIdentifier;null==r&&s(i("Can only store references to tree nodes with a defined identifier.")),this.identifier=r}else s(i(`Can only store references to tree nodes or identifiers, got: '${r=e,JSON.stringify(v(r)?b(r):r)}'`));var r,n}updateResolvedReference(e){const i=t(this.identifier),r=e.root,n=r.identifierCache.getLastCacheModificationPerId(i);if(!this.resolvedReference||this.resolvedReference.lastCacheModification!==n){const{targetType:e}=this;let t=r.identifierCache.resolve(e,i);t||(t={}),this.resolvedReference={node:t,lastCacheModification:n}}}}class W extends P{targetType;constructor(e){super(),this.targetType=e}isAssignableFrom(e){return this.targetType.isAssignableFrom(e)}instantiate(e,t,i,r){const n=f(i)?g(i):p(i)?i.identifier:i;let s;const o=function(e,t,i){const r=new Q(e,t),n=new(a())({data:{isMounted:!1},computed:{ref:()=>r,resolvedValue(){if(!this.isMounted)return;r.updateResolvedReference(this.node);const{value:e}=r.resolvedReference.node;return i&&i(e),e}},watch:{resolvedValue(){}}});return n.node=null,n}(n,this.targetType,(i=>{const r=t.match(/([^/]+)$/)[0],n=e.storedValue;s!==i&&(s=i,n[r]!==i&&(i?i[c]=i:(h[c]=i,i=h),r in n?n instanceof Array?n.splice(+r,1,i):n[r]=i:(n._beforeCreateData=n._beforeCreateData||{},n._beforeCreateData[r]=i)))})),h=I(this,e,t,o,r);return h.identifier=n,o.node=h,o.isMounted=!0,this.watchTargetNodeForInvalidations(h,n,e),h}watchTargetNodeForInvalidations(e,t,i){e.root.referenceCache.addRef(e,t);const r=e._destroy;e._destroy=function(){r.apply(this,arguments),i.root.referenceCache.removeRefs(this,t)}}getValue(e){if(e.isAlive)return e.storedValue.resolvedValue}getSnapshot(e){return e.storedValue.ref.identifier}is(){}}const X={vue:e=>new z(e),vo:(e,t)=>new K(e,t),array:e=>new U(e),literal:e=>new G(e),union:(...e)=>new H(e),compose(){return X.vue(J(...arguments))},composeVo(){return X.vo(void 0,J(...arguments))},identifier:new j("string"),identifierNumber:new j("number"),reference:e=>new W(e)}})(),n})()}));